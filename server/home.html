<!DOCTYPE html>
<html>
<head>
<script src="/socket.io/socket.io.js"></script>
</head>
<body style="background:black;color:white;font-family:sans-serif">

<h2>SSP Home</h2>

<button onclick="logout()">Logout</button>
<button id="shopBtn" onclick="window.location='/shop'">ðŸ›’ Shop</button>

<h3>Coins: <span id="coins">0</span></h3>

<div id="adminPanel" style="display:none">
<h3>Admin Panel</h3>
<button onclick="add500()">+500 Coins</button>
</div>

<h3>Chat</h3>
<div id="chat" style="height:200px;overflow:auto;border:1px solid white"></div>
<input id="msg"><button onclick="send()">Send</button>

<script>
const socket = io();
let username="";

fetch("/me").then(r=>r.json()).then(data=>{
    username=data.username;
    document.getElementById("coins").innerText=data.coins;
    if(data.isAdmin) document.getElementById("adminPanel").style.display="block";
    socket.emit("join", username);
});

function logout(){ window.location="/logout"; }

function add500(){
fetch("/admin/add500",{method:"POST"})
.then(r=>r.json())
.then(d=>document.getElementById("coins").innerText=d.coins);
}

function send(){
let m=document.getElementById("msg").value;
socket.emit("message",username+": "+m);
document.getElementById("msg").value="";
}

socket.on("message",msg=>{
document.getElementById("chat").innerHTML+=msg+"<br>";
});

socket.on("chat-history",msgs=>{
msgs.forEach(m=>document.getElementById("chat").innerHTML+=m+"<br>");
});
</script>
</body>
</html>
