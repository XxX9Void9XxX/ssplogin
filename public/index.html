<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SSP MTG Pack Opener</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;background:black;color:white;font-family:Arial}

/* Coins & admin button */
#coinBox{position:fixed;top:10px;left:10px;background:#111;padding:8px 12px;border-radius:6px;font-size:16px;z-index:9999;}
#addCoinsBtn{position:fixed;top:10px;left:120px;padding:8px 12px;border:none;border-radius:6px;background:#8e44ad;color:white;font-weight:bold;cursor:pointer;box-shadow:0 0 10px #9b59b6,0 0 20px #8e44ad,0 0 30px #9b59b6;animation:glow 1.5s infinite alternate;z-index:9999;}
@keyframes glow{from{box-shadow:0 0 10px #9b59b6,0 0 20px #8e44ad,0 0 30px #9b59b6;}to{box-shadow:0 0 20px #9b59b6,0 0 30px #8e44ad,0 0 40px #9b59b6;}}

/* Shop button */
#shopBtn{position:fixed;top:50px;left:10px;padding:8px 12px;border:none;border-radius:6px;background:#2980b9;color:white;font-weight:bold;cursor:pointer;box-shadow:0 0 5px #3498db,0 0 10px #2980b9;z-index:9999;}

/* Pack Opener */
#packOpener{position:fixed;top:100px;left:50%;transform:translateX(-50%);width:320px;background:#111;padding:12px;border-radius:8px;display:none;z-index:9999;text-align:center;}
#stage{position:relative;width:300px;height:460px;margin:10px auto;}
.pack,.card{position:absolute;width:100%;height:100%;border-radius:10px;background-size:contain;background-repeat:no-repeat;background-position:center;}
.pack{z-index:3;cursor:pointer;}
.card{z-index:1;opacity:0;}
#slash{position:absolute;top:30%;left:-200%;width:220%;height:6px;background:linear-gradient(90deg,transparent,white,transparent);z-index:5;opacity:0;}
.fire{position:absolute;width:12px;height:12px;border-radius:50%;animation:fire 1.2s forwards;}
@keyframes fire{0%{transform:scale(1);opacity:1;}100%{transform:scale(0) translateY(-120px);opacity:0;}}
#resetBtn{display:none;margin:10px auto;padding:10px 18px;font-size:16px;cursor:pointer;background:#000;color:white;border:1px solid #555;}
#cardInventory{margin-top:10px;text-align:left;max-height:200px;overflow:auto;font-size:14px;border-top:1px solid #555;padding-top:5px;}
</style>
</head>
<body>

<!-- SSP Coins -->
<div id="coinBox">Coins: <span id="coinCount">0</span></div>
<button id="addCoinsBtn">+100 Coins</button>
<button id="shopBtn">ðŸ›’ Shop</button>

<!-- MTG Pack Opener -->
<div id="packOpener">
    <h2>MTG Pack Opener</h2>
    <div id="stage">
        <div class="card" id="card"></div>
        <div class="pack" id="pack"></div>
        <div id="slash"></div>
    </div>
    <button id="resetBtn">OPEN ANOTHER PACK</button>
    <div id="cardInventory"><strong>Your Cards:</strong><br></div>
</div>

<script>
// ================= SSP COINS =================
let currentUserCoinsKey=null;
let coins=0;
const coinCount=document.getElementById("coinCount");
const addCoinsBtn=document.getElementById("addCoinsBtn");

// This function must be called after login to set current user coins
function initCoins(username){
    currentUserCoinsKey="coins_"+username;
    coins=parseInt(localStorage.getItem(currentUserCoinsKey))||0;
    coinCount.innerText=coins;
}

// Update coins display and save
function updateCoins(){
    coinCount.innerText=coins;
    if(currentUserCoinsKey) localStorage.setItem(currentUserCoinsKey,coins);
}

// Admin +100 button
addCoinsBtn.onclick=()=>{coins+=100;updateCoins();}

// ================= SHOP =================
const shopBtn=document.getElementById("shopBtn");
const packOpener=document.getElementById("packOpener");
shopBtn.onclick=()=>{packOpener.style.display=packOpener.style.display==="none"?"block":"none"; loadInventory();}

// ================= PACK OPENER =================
const pack=document.getElementById("pack");
const card=document.getElementById("card");
const slash=document.getElementById("slash");
const resetBtn=document.getElementById("resetBtn");
const stage=document.getElementById("stage");
const cardInventory=document.getElementById("cardInventory");

const packImage="https://sspv2play.neocities.org/mtg/pack.png";
const cards=[
    "https://sspv2play.neocities.org/mtg/vma-4-black-lotus.jpg",
    "https://sspv2play.neocities.org/mtg/fdn-1-sire-of-seven-deaths.jpg",
    "https://sspv2play.neocities.org/mtg/cn2-214-platinum-angel.jpg",
    "https://sspv2play.neocities.org/mtg/ltr-246-the-one-ring.jpg",
    "https://sspv2play.neocities.org/mtg/som-176-mindslaver.jpg",
    "https://sspv2play.neocities.org/mtg/baby-doddin-the-consuming-monstrosity.jpg",
    "https://sspv2play.neocities.org/mtg/orange-master-of-the-elements.jpg",
    "https://sspv2play.neocities.org/mtg/vma-2-time-walk.jpg",
    "https://sspv2play.neocities.org/mtg/c19-51-volrath-the-shapestealer.jpg"
];

let opened=false;

// ================= CARD INVENTORY =================
let inventory={};
function loadInventory(){
    inventory=JSON.parse(localStorage.getItem("inventory_"+currentUserCoinsKey)||"{}");
    let html="<strong>Your Cards:</strong><br>";
    for(let c in inventory) html+=`${inventory[c]}x <img src="${c}" width="40"><br>`;
    cardInventory.innerHTML=html;
}
function saveInventory(){localStorage.setItem("inventory_"+currentUserCoinsKey,JSON.stringify(inventory));}

// ================= BORDER MASK =================
function loadAndBorderMask(src,callback){
    const img=new Image();
    img.crossOrigin="anonymous";
    img.onload=()=>{
        const canvas=document.createElement("canvas");
        canvas.width=img.width; canvas.height=img.height;
        const ctx=canvas.getContext("2d");
        ctx.drawImage(img,0,0);
        const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
        const d=imageData.data;
        const w=canvas.width,h=canvas.height,border=8;
        for(let i=0;i<d.length;i+=4){
            const x=(i/4)%w, y=Math.floor((i/4)/w);
            const r=d[i],g=d[i+1],b=d[i+2];
            if(r>235&&g>235&&b>235&&(x<border||x>w-border||y<border||y>h-border)){
                d[i]=d[i+1]=d[i+2]=17;
            }
        }
        ctx.putImageData(imageData,0,0);
        callback(canvas.toDataURL());
    };
    img.src=src;
}

// Load initial pack
loadAndBorderMask(packImage,img=>{pack.style.backgroundImage=`url(${img})`;});

// ================= OPEN PACK =================
pack.onclick=()=>{
    if(opened) return;
    if(coins<100){alert("Not enough coins!"); return;}
    coins-=100; updateCoins();
    opened=true;
    const pull=cards[Math.floor(Math.random()*cards.length)];
    loadAndBorderMask(pull,img=>{card.style.backgroundImage=`url(${img})`;});
    slash.style.transition="none"; slash.style.opacity=1; slash.style.left="-200%";
    setTimeout(()=>{slash.style.transition="left 0.25s ease-out"; slash.style.left="200%";},40);
    setTimeout(()=>slash.style.opacity=0,350);
    setTimeout(spawnFire,250);
    setTimeout(()=>{pack.style.animation="burnAway 1s forwards";},450);
    setTimeout(()=>{
        card.style.opacity=1;
        resetBtn.style.display="block";
        // add to inventory
        inventory[pull]=inventory[pull]?inventory[pull]+1:1;
        saveInventory();
        loadInventory();
    },1400);
};

// ================= RESET =================
resetBtn.onclick=()=>{
    opened=false; resetBtn.style.display="none";
    pack.style.animation=""; pack.style.opacity=1; pack.style.transform="none";
    card.style.opacity=0; card.style.backgroundImage="";
};

// ================= FIRE =================
function spawnFire(){for(let i=0;i<80;i++){const f=document.createElement("div");f.className="fire";f.style.left=Math.random()*300+"px";f.style.top=Math.random()*460+"px";f.style.background=`hsl(${Math.random()*45},100%,50%)`;stage.appendChild(f);setTimeout(()=>f.remove(),1200);}}

// ================= INIT AFTER LOGIN =================
// Example: call initCoins('username_here') after login
</script>
</body>
</html>
