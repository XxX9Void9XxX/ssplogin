<script>
function login(){
  fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},
  body:JSON.stringify({
    username:username.value,
    password:password.value
  })}).then(r=>r.json()).then(d=>{

    if(!d.success){
      if(d.banned){
        return alert("You Have Been Banned");
      }
      return alert("Login failed");
    }

    currentUser=d;

    authBox.style.display="none";
    mainFrame.style.display="block";
    chatBox.style.display="block";

    if(d.role==="admin"){
      adminBtn.style.display="block";
    }

    connectSocket();
  });
}

function loadUsers(){
  fetch("/users").then(r=>r.json()).then(d=>{
    usersList.innerHTML="";

    d.users.forEach(u=>{
      const div=document.createElement("div");
      div.innerHTML=`${u.username} (${u.role})`;

      if(currentUser.role==="admin" && u.username!=="a"){
        const btn=document.createElement("button");
        btn.innerText=u.banned?"Unban":"Ban";
        btn.onclick=()=>{
          fetch("/"+(u.banned?"unban":"ban"),{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
              username:u.username,
              admin:currentUser.username
            })
          }).then(()=>loadUsers());
        };
        div.appendChild(btn);
      }

      usersList.appendChild(div);
    });
  });
}
</script>
