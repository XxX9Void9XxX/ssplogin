<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MTG Pack Opener</title>
<style>
body{margin:0;background:#000;color:white;font-family:Arial;text-align:center}
#loginBox{margin-top:100px}
#game{display:none}
#stage{position:relative;width:300px;height:460px;margin:20px auto}
.pack,.card{position:absolute;width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center;border-radius:10px}
.pack{cursor:pointer;z-index:2}
.card{opacity:0}
#collection{position:fixed;right:10px;top:60px;width:200px;background:#111;padding:10px;max-height:80vh;overflow:auto}
#coins{font-size:18px;margin:10px}
#adminBonus{display:none;margin-bottom:10px}
</style>
</head>
<body>

<div id="loginBox">
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="game">
  <div id="coins"></div>
  <button id="adminBonus" onclick="adminBonus()">+500 Coins</button>
  <div id="stage">
    <div class="card" id="card"></div>
    <div class="pack" id="pack"></div>
  </div>
  <div id="collection"></div>
</div>

<script>
let currentUser=null;
let coins=0;

const pack=document.getElementById("pack");
const cardDiv=document.getElementById("card");

const packImage="https://sspv2play.neocities.org/mtg/pack.png";

const cards=[
"https://sspv2play.neocities.org/mtg/vma-4-black-lotus.jpg",
"https://sspv2play.neocities.org/mtg/fdn-1-sire-of-seven-deaths.jpg",
"https://sspv2play.neocities.org/mtg/cn2-214-platinum-angel.jpg",
"https://sspv2play.neocities.org/mtg/ltr-246-the-one-ring.jpg",
"https://sspv2play.neocities.org/mtg/som-176-mindslaver.jpg",
"https://sspv2play.neocities.org/mtg/baby-doddin-the-consuming-monstrosity.jpg",
"https://sspv2play.neocities.org/mtg/orange-master-of-the-elements.jpg",
"https://sspv2play.neocities.org/mtg/vma-2-time-walk.jpg",
"https://sspv2play.neocities.org/mtg/c19-51-volrath-the-shapestealer.jpg"
];

pack.style.backgroundImage=`url(${packImage})`;

function login(){
fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({username:username.value,password:password.value})})
.then(r=>r.json()).then(d=>{
if(!d.success)return alert("Login failed");
currentUser=d.username;
coins=d.coins;
loginBox.style.display="none";
game.style.display="block";
if(d.role==="admin")adminBonus.style.display="block";
updateCoins();
loadUserData();
});
}

function updateCoins(){
coinsDiv=document.getElementById("coins");
coinsDiv.innerText="Coins: "+coins;
}

function loadUserData(){
fetch("/userdata/"+currentUser)
.then(r=>r.json())
.then(d=>{
coins=d.coins;
updateCoins();
renderCollection(d.cards);
});
}

function renderCollection(cards){
const col=document.getElementById("collection");
col.innerHTML="<h3>Collection</h3>";
cards.forEach(c=>{
col.innerHTML+=`
<div>
<img src="${c.card}" width="60"><br>
x${c.count}
</div><hr>`;
});
}

pack.onclick=()=>{
if(coins<100)return alert("Not enough coins");
const pull=cards[Math.floor(Math.random()*cards.length)];
cardDiv.style.backgroundImage=`url(${pull})`;
cardDiv.style.opacity=1;

fetch("/openpack",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({username:currentUser,card:pull})})
.then(()=>loadUserData());
};

function adminBonus(){
fetch("/adminbonus",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({username:currentUser})})
.then(()=>loadUserData());
}
</script>

</body>
</html>
